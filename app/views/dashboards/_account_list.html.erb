<% if accounts.present? %>
  <div class="list-group">
    <% accounts.each do |account| %>
      <div class="list-group-item list-group-item-action mb-2" data-controller="payout-form">
        <div class="d-flex w-100 justify-content-between align-items-center">
          <div>
            <h5 class="mb-1"><%= account[:name] %></h5>
            <p class="mb-1 text-muted small">ID: <%= account[:id] %></p>
          </div>
          <div class="btn-group">
            <%= link_to "Create Payout Request", "#", 
                class: "btn btn-sm btn-outline-primary", 
                data: { action: "click->payout-form#toggleForm" } %>
            <%= link_to "Show Payout Requests", payouts_path(account[:id]), 
                class: "btn btn-sm btn-outline-secondary" %>
          </div>
        </div>


        <div class="mt-3 d-none" data-payout-form-target="form">
          <hr />

          <h6>Create Payout Request</h6>
          
          <%= form_with url: payouts_path, method: :post, class: "payout-form", data: { turbo: true } do |f| %>
            <%= f.hidden_field :sourceAccountId, value: account[:id] %>
            <%= f.hidden_field :memo, value: "December contract" %>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <h6 class="mb-2">Amount Details</h6>
                <div class="mb-2">
                  <%= f.label :tokenSymbol, "Token Symbol", class: "form-label" %>
                  <%= f.text_field :tokenSymbol, class: "form-control", placeholder: "USDC", value: "USDC" %>
                </div>
                <div class="mb-2">
                  <%= f.label :tokenAmount, "Token Amount", class: "form-label" %>
                  <%= f.number_field :tokenAmount, class: "form-control", step: "0.01", placeholder: "100" %>
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="mb-2">Payout Details</h6>
                <%= f.hidden_field :type, value: "fiat" %>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :bankName, "Bank Name", class: "form-label" %>
                      <%= f.text_field :bankName, class: "form-control", placeholder: "Bancamia S.A." %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :bankAccountOwner, "Bank Account Owner", class: "form-label" %>
                      <%= f.text_field :bankAccountOwner, class: "form-control" %>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-4">
                    <div class="mb-2">
                      <%= f.label :fiatType, "Fiat Type", class: "form-label" %>
                      <%= f.text_field :fiatType, class: "form-control", value: "cop" %>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="mb-2">
                      <%= f.label :fiatSymbol, "Fiat Symbol", class: "form-label" %>
                      <%= f.text_field :fiatSymbol, class: "form-control", value: "COP" %>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="mb-2">
                      <%= f.label :accountType, "Account Type", class: "form-label" %>
                      <%= f.select :accountType, 
                          options_for_select([["Checking", "CHECKING"], ["Savings", "SAVINGS"]]), 
                          {}, { class: "form-select" } %>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :phoneNumber, "Phone Number", class: "form-label" %>
                      <%= f.telephone_field :phoneNumber, class: "form-control", placeholder: "+57 601 555 5555" %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :bankAccountNumber, "Bank Account Number", class: "form-label" %>
                      <%= f.text_field :bankAccountNumber, class: "form-control" %>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :documentNumber, "Document Number", class: "form-label" %>
                      <%= f.text_field :documentNumber, class: "form-control" %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :documentType, "Document Type", class: "form-label" %>
                      <%= f.select :documentType, 
                          options_for_select([["National ID", "NATIONAL_ID"], ["Passport", "PASSPORT"]]), 
                          {}, { class: "form-select" } %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="mb-2">Recipient Information</h6>
                <%= f.hidden_field :recipientType, value: "individual" %>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :firstName, "First Name", class: "form-label" %>
                      <%= f.text_field :firstName, class: "form-control" %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :lastName, "Last Name", class: "form-label" %>
                      <%= f.text_field :lastName, class: "form-control" %>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :email, "Email", class: "form-label" %>
                      <%= f.email_field :email, class: "form-control" %>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-2">
                      <%= f.label :dateOfBirth, "Date of Birth", class: "form-label" %>
                      <%= f.date_field :dateOfBirth, class: "form-control" %>
                    </div>
                  </div>
                </div>
                
                <h6 class="mb-2 mt-3">Physical Address</h6>
                <div class="row">
                  <div class="col-md-12">
                    <div class="mb-2">
                      <%= f.label :address1, "Address", class: "form-label" %>
                      <%= f.text_field :address1, class: "form-control" %>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-3">
                    <div class="mb-2">
                      <%= f.label :country, "Country", class: "form-label" %>
                      <%= f.text_field :country, class: "form-control", placeholder: "CO" %>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="mb-2">
                      <%= f.label :state, "State", class: "form-label" %>
                      <%= f.text_field :state, class: "form-control", placeholder: "Antioquia" %>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="mb-2">
                      <%= f.label :city, "City", class: "form-label" %>
                      <%= f.text_field :city, class: "form-control" %>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="mb-2">
                      <%= f.label :zip, "Zip Code", class: "form-label" %>
                      <%= f.text_field :zip, class: "form-control" %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="d-flex justify-content-between mt-3">
              <%= f.submit "Create Payout Request", class: "btn btn-primary" %>
              <button type="button" class="btn btn-outline-secondary" data-action="payout-form#hideForm">Cancel</button>
            </div>
          <% end %>
          
          <div id="payout-request-details">
          </div>
        </div>
      </div>
      <% end %>
  </div>
<% else %>
  <div class="alert alert-info">
    <p>You don't have any accounts yet. Create one using the form on the left.</p>
  </div>
<% end %>
